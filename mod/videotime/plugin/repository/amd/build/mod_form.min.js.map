{"version":3,"sources":["../src/mod_form.js"],"names":["define","$","ModalFactory","ModalVideoList","str","Ajax","init","isTotara","contextId","trigger","requiredstrings","push","key","component","get_strings","done","strings","call","methodname","args","then","response","is_totara","create","type","TYPE","title","templateContext","modal","setContextId","setReadOnly","refreshTable","on","e","originalLabel","target","val","attr","prop","link","videoId","split","isNaN","alert","promises","apiResponse","JSON","parse","data","status","body","error","video","name","description","html","duration","empty","each","tags","index","tag","append","bind"],"mappings":"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","sourcesContent":["define(['jquery', 'core/modal_factory', 'videotimeplugin_repository/modal_video_list', 'core/str', 'core/ajax'], function($, ModalFactory, ModalVideoList, str, Ajax) {\n\n    var init = function(isTotara, contextId) {\n        var trigger = $('#id_choose_video');\n\n        var requiredstrings = [];\n        requiredstrings.push({key: 'choose_video', component: 'videotime'});\n        requiredstrings.push({key: 'pull_from_vimeo_loading', component: 'videotime'});\n        requiredstrings.push({key: 'pull_from_vimeo_invalid_videoid', component: 'videotime'});\n        requiredstrings.push({key: 'pull_from_vimeo_success', component: 'videotime'});\n\n        str.get_strings(requiredstrings).done(function(strings) {\n            Ajax.call([{\n                methodname: 'videotimeplugin_repository_get_filter_options',\n                args: {}\n            }])[0].then(function(response) {\n                response.is_totara = isTotara;\n                ModalFactory.create({\n                    type: ModalVideoList.TYPE,\n                    title: strings[0],\n                    templateContext: response // Moodle template context.\n                }, trigger, response).done(function (modal) { // Totara template context.\n                    modal.setContextId(contextId);\n                    modal.setReadOnly(false);\n                    modal.init();\n                    modal.refreshTable();\n                });\n            });\n\n            $(\"#id_pull_from_vimeo\").on('click', function(e) {\n                var originalLabel = $(e.target).val();\n                $(e.target).attr('value', strings[1]);\n                $(e.target).prop('disabled', true);\n\n                var link = $(\"#id_vimeo_url\").val();\n                var videoId = link.split('/')[3];\n\n                if (isNaN(videoId)) {\n                    alert(strings[2]);\n                    $(e.target).attr('value', originalLabel);\n                    $(e.target).prop('disabled', false);\n                    return;\n                }\n\n                var promises = Ajax.call([\n                    {\n                        methodname: 'videotimeplugin_repository_api_request', args: {\n                            'url': '/videos/' + videoId,\n                            'contextid': contextId\n                        }\n                    }\n                ]);\n\n                promises[0].done(function(response) {\n                    var apiResponse = JSON.parse(response.data);\n                    if (apiResponse.status != 200) {\n                        alert('API error: ' + apiResponse.body.error);\n                        $(e.target).attr('value', originalLabel);\n                        $(e.target).prop('disabled', false);\n                        return;\n                    }\n\n                    var video = apiResponse.body;\n\n                    alert(strings[3]);\n\n                    $('#id_name').val(video.name);\n                    $('#id_introeditor').val(video.description);\n                    $('#id_introeditoreditable').html(video.description);\n                    $('#id_completion_on_view_time_second').val(video.duration);\n\n                    // Add tags\n                    // First remove any selections.\n                    $(\"#fitem_id_tags .form-autocomplete-selection\").empty();\n                    $(\"#fitem_id_tags #id_tags\").empty();\n                    $.each(video.tags, function(index, tag) {\n                        $(\"#fitem_id_tags #id_tags\").append('<option data-iscustom=\"true\" value=\"' + tag.name +\n                            '\" selected>' + tag.name + '</option>');\n                        $(\"#fitem_id_tags .form-autocomplete-selection\").append('<span role=\"listitem\" data-value=\"' +\n                            tag.name + '\" aria-selected=\"true\" class=\"label label-info\"><span aria-hidden=\"true\">Ã— </span>' +\n                            tag.name + '</span>');\n                    });\n\n                    $(e.target).attr('value', originalLabel);\n                    $(e.target).prop('disabled', false);\n                }.bind(this));\n            });\n        }.bind(this));\n    };\n\n    return {\n        init: init\n    };\n});\n"],"file":"mod_form.min.js"}